# 前言

1、衡量代码的唯一有效标准：WTF/min

2、代码技艺，习艺有两点：知和行。

知：应当习得有关原则、模式和实践的知识；

行：穷尽应知之事，并对其了如指掌，通过刻苦实践掌握它。在实践中，体验自己的失败，观察别人的实践与失败。以人为镜。


# 第1章 整洁代码

## 1.1 要有代码

将需求明确到机器可以执行的细节程度，就是编程要做的事。而这种规约正式代码。

## 1.2 糟糕的代码

一个公司的毁灭，赶着推出产品，代码写的乱七八糟，特性越加越多，代码也越来越烂，最后再也没法管理这些代码了。糟糕的代码毁了这家公司。

勒布朗法则：稍后等于永不。

### 1.3 混乱的代价

1、混乱的增加->团队生产力持续下降->增加人手->新人不熟悉系统设计->制造更多的混乱

2、混乱的增加，促使开发人员希望重新设计，一部分人参与新系统的开发，一部分人维护老系统，两个系统并行相互竞赛，当新系统赶上老系统时，有可能新系统已经换了几波人了，又是一个怪圈。

3、制造混乱无法帮助我们赶上期限，只能拖慢自己，做的快，赶上期限的唯一方法，就是始终保持代码整洁。

4、优雅和高效的代码，代码逻辑应当直接了当，缺陷难以隐藏；尽量减少依赖关系，使之便于维护；依据某种分层战略完善错误处理代码；性能调至最优，省的引导别人做没规矩的优化。整洁的代码只做好一件事。

5、防止破窗理论。保持整洁的习惯，发现脏代码就要及时纠正。花时间保持代码代码整洁，这不但有关效率，还有关项目的生存。

6、整洁的代码从不隐藏设计者的意图，充满了干净利落的抽象和直截了当的控制语句。让代码比来时更干净。

7、整洁的代码应当有单元测试和验收测试；使用有意义的命名；只提供一种做一件事的途径；要明确地定义和提供清晰、尽量少的API；通过字面表达含义。

8、能通过所有测试；没有重复代码；体现系统中的全部设计理念；包括尽量少的实体，比如类、方法、函数等。

9、编写代码的难度，在于读周边代码的难度，提升效率的一种方式，让代码易读。

10、 程序员遵从不了解混乱风险的产品经理(策划)的意愿，都是不专业的做法。

# 第二章 命名规则

要点一：要名副其实。一个好的变量、函数或类的名称应该已经答复了所有的大问题。一个好名称可以大概告诉你这个名称所代表的内容，为什么会存在，做了什么事情，应该如何用等。

要点二：要避免误导。我们应该避免留下隐藏代码本意的错误线索，也应该避免使用与本意相悖的词。

要点三：尽量做有意义的区分。尽量避免使用数字系列命名（a1、a2…….aN）和没有意义的区分。

要点四：尽量使用读得出来的名称。如名称读不出来，讨论的时候会不方便且很尴尬。

要点五：尽量使用可搜索的名称。名称长短应与其作用域大小相对应，若变量或常量可能在代码中多处使用，应赋予其以便于搜索的名称。

要点六：取名不要绕弯子。取名要直白，要直截了当，明确就是王道。

要点七：类名尽量用名词。类名尽量用名词或名词短语，最好不要是动词。

要点八：方法名尽量用动词。方法名尽量用动词或动词短语。

要点九：每个概念对应一词，并一以贯之。对于那些会用到你代码的程序员，一以贯之的命名法简直就是天降福音。

要点十：通俗易懂。应尽力写出易于理解的变量名，要把代码写得让别人能一目了然，而不必让人去非常费力地去揣摩其含义。

要点十一：尽情使用解决方案领域专业术语。尽管去用那些计算机科学领域的专业术语、算法名、模式名、数学术语。

要点十二：要添加有意义的语境。需要用有良好命名的类，函数或名称空间来放置名称，给读者提供语境。若没能提供放置的地方，还可以给名称添加前缀。

# 第3章 函数书写准则


第一原则：短小。若没有特殊情况，最好将单个函数控制在十行以内。代码块和缩进：if,else,while语句等，其中的代码块应该只有一行。

第二原则：单一职责。函数应该只做一件事情。只做一件事，做好这件事。每个函数中只该有一个return语句，循环中不能有break或continue语句。

第三原则：命名合适且具描述性。长而具有描述性的名称，比短而令人费解的名称好。当然，如果短的名称已经足够说明问题，还是越短越好。

第四原则：参数尽可能少。最理想的函数参数形态是零参数，其次是单参数，再次是双参数，应尽量避免三参数及以上参数的函数，有足够的理由才能用三个以上参数。

第五原则：尽力避免重复。重复的代码会导致模块的臃肿，整个模块的可读性可能会应该重复的消除而得到提升。异常处理最好将try/catch抽离出来作为一个新的函数，因为它的结构会混淆正常流程。错误处理就是一件事。catch后面不应该有其他的。

# 第4章 注释

第一原则：像报纸一样一目了然。优秀的源文件也要像报纸文章一样，名称应当简单并且一目了然，名称本身应该足够告诉我们是否在正确的模块中。源文件最顶部应该给出高层次概念和算法。细节应该往下渐次展开，直至找到源文件中最底层的函数和细节。

第二原则：恰如其分的注释。带有少量注释的整洁而有力的代码，比带有大量注释的零碎而复杂的代码更加优秀。

第三原则：合适的单文件行数。尽可能用几百行以内的单文件来构造出出色的系统，因为短文件通常比长文件更易于理解。

第四原则：合理地利用空白行。在每个命名空间、类、函数之间，都需用空白行隔开。

第五原则：让紧密相关的代码相互靠近。靠近的代码行暗示着他们之间的紧密联系。所以，紧密相关的代码应该相互靠近。

# 第5章 格式

变量的声明应尽可能靠近其使用位置。

循环中的控制变量应该在循环语句中声明。

短函数中的本地变量应当在函数的顶部声明。

对于某些长函数，变量也可以在某代码块的顶部，或在循环之前声明。

实体变量应当在类的顶部声明。

若某个函数调用了另一个，就应该把它们放到一起，而且调用者应该尽量放到被调用者上面。

概念相关的代码应该放到一起。相关性越强，则彼此之间的距离就该越短。

团队遵从同一套代码规范。一个好的团队应当约定与遵从一套代码规范，并且每个成员都应当采用此风格。

# 第6章 对象和数据结构


## 6.1 数据抽象


## 6.2 数据、对象的反对称性

## 6.3 得墨忒耳定律

1、模块不应了解它所操作对象的内部情形。

2、方法不应调用由任何函数返回的对象的方法。只跟朋友谈话，不与陌生人谈话。

3、得墨忒耳律要看是对象还是数据结构。

## 6.4 数据传送对象

最为精炼的数据结构，是一个只有公共变量、没有函数的类。DTO


# 第7章 错误处理

## 7.1 使用异常而非返回码

## 7.2 先写tru/catch/finally语句

## 7.3 使用不可控异常

## 7.4 给出异常发生的环境说明

## 7.5 依调用者需要定义异常类

## 7.6 定义常规流程

## 7.7 别返回null值

避免NPE的出现。

## 7.8 别传递null值

# 第8章 边界

## 8.1 使用第三方代码

第三方程序包和框架提供者追求普适性。

## 8.2 浏览和学习边界

1、不要在生产代码中试验新东西，而是编写测试来浏览和理解第三方代码。

2、学习性测试。

## 8.3 学习log4j

1、这一部分其实讲的是怎么讲一个东西进行封装到自己的类中，而使得这部分与其他应用程序隔离。

## 8.4 学习性测试的好处不只是免费

1、学习性测试确保第三方程序包按照我们想要的方式工作。

## 8.5 使用尚不存在的代码

这部分讲的是将一些未知的代码封装起来，可以通过伪造的代码进行测试，这样不需要取太过关系真正封装起来的那些逻辑。

## 8.6 整洁的边界

避免我们的代码过多地了解第三方代码中的特定信息。

# 第9章 单元测试

## 9.1 TDD三定律（在编写生产代码前，先编写单元测试）

1、在编写不能通过的单元测试前，不可编写生产代码。

2、只可编写刚好无法通过的单元测试，不能编译也算不通过。

3、只可编写刚好足以通过当前失败测试的生产代码。

## 9.2 保持测试整洁

1、脏测试等同于没测试。

2、测试代码和生产代码一样重要。

3、单元测试让代码可扩展、可维护、可复用。

## 9.3 整洁的测试

1、可读性。

2、测试三个环节：构造-操作-检验。

3、使用面向特定领域的测试语言。

4、测试代码应当简单、精悍、足具表达力，但要和生产代码一般有效。

## 9.4 每个测试一个断言

1、每个测试中的断言数量应该最小化。

2、每个测试一个概念，不要一个测试超长。

## 9.5 F.I.R.S.T

1、快速，测试应当够快。

2、独立，测试之间要相互独立。某个测试不应为下一个测试的设定条件。

3、可重复，在任何环境中重复通过。

4、自足验证，测试应有布尔值输出，不能人为比较。

5、及时，及时编写。

# 第10章 类


原则一：合理地分布类中的代码。 类中代码的分布顺序大致是：
公有静态常量
私有静态变量
公有普通变量
私有普通变量
公共函数
私有函数

原则二：尽可能地保持类的封装。尽可能使函数或变量保持私有，不对外暴露太多细节。

原则三：类应该短小，尽量保持单一权责原则。类或模块应有且只有一条加以修改的理由。

原则四：合理提高类的内聚性。我们希望类的内聚性保持在较高的水平。内聚性高，表示类中方法和变量相互依赖，相互结合成一个逻辑整体。

原则五：有效地隔离修改。类应该依赖于抽象，而不是依赖于具体细节。尽量对设计解耦，做好系统中的元素的相互隔离，做到更加灵活与可复用。

# 第11章 系统

## 11.1 如何建造一个城市

## 11.2 将系统的构造与使用分开

1、软件系统应将启始过程和启始过程之后的运行逻辑分离。

2、分解main。

3、工厂，目前我们的系统都是使用spring来管理实例化对象，已经做到了系统的构造与使用分离。

## 11.3 扩容

1、系统的扩展。

2、切面的重要性。

## 11.4 Java代理

## 11.5 纯Java AOP框架

# 第12章 迭进

## 12.1 通过迭进设计达到整洁目的

1、简单设计规则：

运行所有测试

不可重复

表达了程序员的意图

尽可能减少类和方法的数量

## 12.2 简单设计规则1：运行所有测试

1、全面测试并持续通过所有测试。

2、紧耦合的代码，难以编写测试。（使用DI，接口和抽象工具解耦）

## 12.3 简单设计规则2-4：重构

## 12.4 不可重复

## 12.5 表达力

## 12.6 尽可能少的类和方法