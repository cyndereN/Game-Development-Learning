# 游戏中渲染管线、后处理和其他的一切

## 环境光遮蔽

Approximation of attenuation of ambient light due to occlusion

Precomputed AO: Using ray tracing to compute the AO offline and store the result into texture 

GTAO是目前AO的前沿方向，已经可以接近离线光线追踪产生的AO效果，通过一个拟合方程得到光线多次弹射后的AO效果。

RTAO也是目前的前沿方向，技术基础是RTRT

## 雾效

在《Unity Shader 入门精要》的屏幕空间雾效后处理中有详细系统的讲解

Depth Fog.

Fog 的本质是气溶胶，它和高度有一定的关系。

高度雾的分布是在某一高度值以下雾的浓度是一个常数，但超过这个高度后雾浓度逐渐稀薄，因此在求解从某一高度观察某一物体的雾效时需要积分运算，但是为了降低游戏运行时硬件负担，可以把事先计算好的解析值直接带入使用。

体积雾可以产生丁达尔效应。

和体积云不同，Volumetric并不是均匀分布，而是在camera的视锥内按照近密远疏分布，更符合自然效果。

体积雾的生成与体积云类似，但使用的是3Dtexture。

## 抗锯齿

Reason of aliasing:

Edge Sampling; Texture Sampling, Specular Sampling


SSAA, MSAA: 运算量大，用的少了

FXAA：提取边缘，把走样的边缘换成正常的边缘，商业游戏实用

TAA：时间维度Temporal的抗锯齿，借用前一帧的数据。也是现代引擎常用的方法（RTRT的Motion Vector底层方法与TAA是相同的）


## 后处理

建议参考《Unity Shader 入门精要》相关章节，更清晰详细

Color Grading（颜色分级）类似电影调色，通过一张Lookup Table（LUT）把整体色调映射到另一种已经被艺术家加工过的色调。

## 渲染管线

Forward Rendering 较为传统。

Deferred Rendering 主流渲染管线。

Tile-based Rendering 通过分割screen提高渲染效率。

Forward+ Rendering 即Forward与Tile-based结合。

Cluster-based Rendering 与Tile-based思想类似，把camera视锥划分成一个个格子分别渲染。

Visibility Buffer 未来的新发展方向，适合更大量、复杂的几何空间。把几何信息和材质信息分离开来，先判断哪些mesh可见并存储起来（V-Buffer存储这些几何属性），再根据GO的唯一ID去索引材质信息，最后完成shading 光栅化。

随着大场景、大世界、模型细节要求增高，模型的面片数量越来越多，传统的渲染管线会drawover，对许多不需要被渲染的面片浪费大量算力。并且deferred rendering 查找G-Buffer的速度要慢于Visibility Buffer查找V-Buffer 和 ID。

Visibility Buffer可以支持更多更复杂的材质。

挑战：

1.不同项目大量复杂的、不同的渲染需求，引擎各种模块与不同算法如何搭建；

2.在复杂的项目中如何管理存储资源（各种buffer），避免存储资源浪费，最大效率的利用；

3.新的图形API把更多的硬件管理开放给开发者，因此硬件资源的调用和管理难度很大；